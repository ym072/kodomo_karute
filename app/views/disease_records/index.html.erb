<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>medical record - 過去の体調不良一覧</title>
</head>
<body>
  <main class="login-main">

  <div class="summary-header">
      <h2>過去の体調不良検索</h2>
    </div>

  <%= form_with url: kid_disease_records_path(@kid), method: :get, local: true do |f| %>
    <div class="form-row"> 
      <%= f.text_field :disease_name, placeholder: "病名", rows: 2, class: "form-control" %>
    </div>
  
    <div class="form-row">
    <%= f.select :symptom_name_id,
    options_from_collection_for_select(SymptomName.all, :id, :name),
    { include_blank: "症状を選択してください" },
    { class: "form-control" } %>
    </div>
  
    <div class="form-row form-row--date">
    <%= f.date_field :from, class: "form-control" %>
    <span class="date-separator">〜</span>
    <%= f.date_field :to, class: "form-control" %>
  </div>
  
  <div class="form-actions">
    <%= f.submit "検索", class: "search-button"%>
  </div>
  <% end %>

    <div class="summary-header">
      <h2>過去の体調不良一覧</h2>
    </div>

    <ul class="record-list">
  <% @disease_records.each do |record| %>
    <% symptom_names =
      record.reported_symptoms
            .map { |rs| rs.symptom_name&.name }
            .compact
            .uniq
    %>
    <% if record.reported_symptoms.any? { |rs| rs.body_temperature.present? } %>
      <% symptom_names << "体温" unless symptom_names.include?("体温") %>
    <% end %>

    <li class="record-card">
      <div class="record-card__header">
        <div class="record-period">
          <%= l record.start_at.to_date, format: :long %>
          <span class="record-period__sep">〜</span>
          <%= l record.end_at.to_date, format: :long %>
        </div>

        <div class="record-name"><%= record.name %></div>
      </div>

      <div class="record-symptoms">
        <% if symptom_names.any? %>
          <% symptom_names.each do |name| %>
            <span class="mini-tag"><%= name %></span>
          <% end %>
        <% else %>
          <span class="record-symptoms__empty">症状の記録なし</span>
        <% end %>
      </div>
    </li>
  <% end %>
</ul>
</body>
</html>